Option Explicit

Public listaGraficos As Collection
Private Function RightmostUorgEnd(ByVal titulo As String) As Long
    Dim u As Variant, pat As String
    Dim p As Long, bestEnd As Long
    
    ' Normaliza traço: também trata caso o título use EN DASH "–"
    Dim tituloNorm As String
    tituloNorm = Replace(titulo, " – ", " - ")
    
    bestEnd = 0
    For Each u In listUorg
        pat = " - " & CStr(u)
        ' Procura da direita para a esquerda (case-insensitive)
        p = InStrRev(tituloNorm, pat, -1, vbTextCompare)
        If p > 0 Then
            If p + Len(pat) > bestEnd Then
                bestEnd = p + Len(pat)
            End If
        End If
    Next u
    
    RightmostUorgEnd = bestEnd
End Function

Public Sub FiltrarSlicerPorSetor(setor As String)
    Dim sc As SlicerCache, visList(0 To 0) As String
    Set sc = ThisWorkbook.SlicerCaches(NOME_SLICER)
    
    If sc.OLAP Then
        visList(0) = "[Dados Tratados].[UORG - corrigido].&[" & setor & "]"
        sc.ClearManualFilter
        sc.VisibleSlicerItemsList = visList
    Else
        Dim si As SlicerItem
        sc.ClearManualFilter
        For Each si In sc.SlicerItems
            si.Selected = (si.Name = setor)
        Next si
    End If
End Sub
